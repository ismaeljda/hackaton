<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Destination: {{ destination_name }} - Explorateur de Voyages</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/destination.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/restaurants.css') }}">
    
    <!-- Weather Icons CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/weather-icons/2.0.10/css/weather-icons.min.css" rel="stylesheet">
</head>

<body>
    <div id="loadingOverlay" class="loading-overlay">
        <div class="spinner-container">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Chargement des restaurants...</span>
            </div>
            <p class="loading-text">Recherche des meilleurs restaurants...</p>
        </div>
    </div>

    <nav class="navbar navbar-expand-lg navbar-light">
        <div class="container">
            <a class="navbar-brand" href="{{ url_for('index') }}">
                <i class="bi bi-airplane-fill me-2"></i>
                Explorateur de Voyages
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('index') }}">Accueil</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('search') }}">Rechercher</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid destination-container">
        <!-- Header Section -->
        <div class="destination-header mb-4">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <h1 class="display-4">
                        <i class="bi bi-geo-alt-fill me-3"></i>
                        {{ destination_name }}
                    </h1>
                    <p class="lead text-muted">Découvrez les meilleurs restaurants</p>
                </div>
                <div class="col-md-4 text-end">
                    {% if weather %}
                    <div class="weather-info">
                        <div class="weather-temp">{{ weather.temperature }}°C</div>
                        <div class="weather-desc">{{ weather.description }}</div>
                        <i class="wi wi-{{ weather.icon }} weather-icon"></i>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Sidebar -->
            <div class="col-lg-4 col-xl-3">
                <div class="destination-sidebar">
                    <!-- Quick Filters -->
                    <div class="filters-card">
                        <div class="card-header">
                            <h5><i class="bi bi-funnel me-2"></i>Filtrer les Restaurants</h5>
                        </div>
                        <div class="card-body">
                            <!-- Cuisine Filter -->
                            <div class="mb-3">
                                <label class="form-label">Type de cuisine</label>
                                <select class="form-select" id="cuisineFilter">
                                    <option value="">Toutes les cuisines</option>
                                    <option value="italian">Italienne</option>
                                    <option value="french">Française</option>
                                    <option value="spanish">Espagnole</option>
                                    <option value="asian">Asiatique</option>
                                    <option value="mediterranean">Méditerranéenne</option>
                                    <option value="american">Américaine</option>
                                    <option value="mexican">Mexicaine</option>
                                    <option value="indian">Indienne</option>
                                </select>
                            </div>

                            <!-- Price Range Filter -->
                            <div class="mb-3">
                                <label class="form-label">Gamme de prix</label>
                                <select class="form-select" id="priceFilter">
                                    <option value="">Tous les prix</option>
                                    <option value="1">€ (Bon marché)</option>
                                    <option value="2">€€ (Modéré)</option>
                                    <option value="3">€€€ (Cher)</option>
                                    <option value="4">€€€€ (Très cher)</option>
                                </select>
                            </div>

                            <!-- Rating Filter -->
                            <div class="mb-3">
                                <label class="form-label">Note minimale</label>
                                <select class="form-select" id="ratingFilter">
                                    <option value="">Toutes les notes</option>
                                    <option value="4.5">4.5+ étoiles</option>
                                    <option value="4.0">4.0+ étoiles</option>
                                    <option value="3.5">3.5+ étoiles</option>
                                    <option value="3.0">3.0+ étoiles</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Main Content - Restaurants -->
            <div class="col-lg-8 col-xl-9 destination-main">
                
                <!-- Flight Info Section (if coming from search results) -->
                {% if has_flight_data and flight %}
                <div class="flight-info-section">
                    <h4><i class="bi bi-airplane me-2"></i>Votre vol sélectionné</h4>
                    <div class="selected-flight-card">
                        <div class="flight-route-info">
                            <div class="route-visual">
                                <span class="airport-code">{{ flight.origin }}</span>
                                <i class="bi bi-arrow-right"></i>
                                <span class="airport-code">{{ flight.destination }}</span>
                            </div>
                            <div class="flight-details">
                                <div class="detail">
                                    <strong>Prix total:</strong> €{{ flight.total_price }}
                                </div>
                            </div>
                        </div>
                        <div class="flight-actions">
                            <a href="{{ flight.booking_url }}" target="_blank" class="btn btn-success btn-sm">
                                <i class="bi bi-cart-plus me-1"></i>Réserver
                            </a>
                        </div>
                    </div>
                </div>
                {% endif %}

                <!-- Restaurants Header -->
                <div class="restaurants-header">
                    <div>
                        <h3><i class="bi bi-cup-hot me-2"></i>Restaurants recommandés</h3>
                        <div class="restaurants-count">
                            <span id="restaurantsCount">0</span> restaurants trouvés
                        </div>
                    </div>
                    
                    <!-- Sort Options -->
                    <div class="sort-options">
                        <label class="form-label mb-2">Trier par :</label>
                        <select class="form-select" id="sortSelect" style="width: auto;">
                            <option value="rating">Note (meilleure)</option>
                            <option value="reviews">Nombre d'avis</option>
                            <option value="price_low">Prix (€ → €€€€)</option>
                            <option value="price_high">Prix (€€€€ → €)</option>
                        </select>
                    </div>
                </div>

                <!-- Restaurants Grid -->
                <div id="restaurantsContainer">
                    <div class="restaurants-grid">
                        <!-- Restaurants will be loaded here by JavaScript -->
                    </div>
                </div>

                <!-- No Restaurants Message -->
                <div id="noRestaurants" class="no-restaurants d-none">
                    <div class="no-restaurants-content">
                        <i class="bi bi-emoji-frown display-1 text-muted mb-3"></i>
                        <h4>Aucun restaurant trouvé</h4>
                        <p class="text-muted">Essayez d'ajuster vos filtres ou explorez d'autres destinations.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/destination.js') }}"></script>
    
    <script>
        // Pass data from Python to JavaScript
        window.destinationCode = "{{ destination_code }}";
        window.destinationName = "{{ destination_name }}";
    </script>
</body>
</html>